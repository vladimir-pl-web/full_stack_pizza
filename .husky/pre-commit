#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ ESLint –∏ Prettier staged —Ñ–∞–π–ª–æ–≤‚Ä¶"

# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ staged —Ñ–∞–π–ª—ã
STAGED_TS=$(git diff --cached --name-only --diff-filter=ACM | grep -E "\.(ts|tsx|js|jsx)$")
STAGED_OTHER=$(git diff --cached --name-only --diff-filter=ACM | grep -E "\.(json|md|css|scss)$")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ ESLint
if [ -n "$STAGED_TS" ]; then
  npx eslint $STAGED_TS
  if [ $? -ne 0 ]; then
    echo "‚ùå ESLint failed. Commit aborted."
    exit 1
  fi
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Prettier
if [ -n "$STAGED_TS$STAGED_OTHER" ]; then
  npx prettier --check $STAGED_TS $STAGED_OTHER
  if [ $? -ne 0 ]; then
    echo "‚ùå Prettier check failed. Commit aborted."
    exit 1
  fi
fi

echo "‚úÖ Lint –∏ Prettier –ø—Ä–æ–π–¥–µ–Ω—ã. Commit allowed."

