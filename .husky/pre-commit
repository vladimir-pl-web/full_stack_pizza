#!/bin/sh

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ ESLint –∏ Prettier staged —Ñ–∞–π–ª–æ–≤‚Ä¶"

# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ staged TS/JS —Ñ–∞–π–ª—ã
STAGED_TS=$(git diff --cached --name-only --diff-filter=ACM | grep -E "\.(ts|tsx|js|jsx)$" || true)

# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ staged –¥—Ä—É–≥–∏–µ —Ñ–∞–π–ª—ã –¥–ª—è Prettier
STAGED_OTHER=$(git diff --cached --name-only --diff-filter=ACM | grep -E "\.(json|md|css|scss)$" || true)

# ESLint –ø—Ä–æ–≤–µ—Ä–∫–∞
if [ -n "$STAGED_TS" ]; then
  echo "üîπ ESLint –¥–ª—è staged TS/JS —Ñ–∞–π–ª–æ–≤"
  npx eslint $STAGED_TS
  if [ $? -ne 0 ]; then
    echo "‚ùå ESLint failed. Commit aborted."
    exit 1
  fi
fi

# Prettier –ø—Ä–æ–≤–µ—Ä–∫–∞
if [ -n "$STAGED_TS$STAGED_OTHER" ]; then
  echo "üîπ Prettier –¥–ª—è staged —Ñ–∞–π–ª–æ–≤"
  npx prettier --check $STAGED_TS $STAGED_OTHER
  if [ $? -ne 0 ]; then
    echo "‚ùå Prettier check failed. Commit aborted."
    exit 1
  fi
fi

echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã. Commit allowed."
